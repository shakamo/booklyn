{"filter":false,"title":"episode.rb","tooltip":"/app/models/episode.rb","undoManager":{"mark":48,"position":48,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":16},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":4},"end":{"row":4,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":4},"end":{"row":3,"column":5}},"text":"<"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":5},"end":{"row":3,"column":6}},"text":"<"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":7},"end":{"row":3,"column":8}},"text":"Q"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"L"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"L"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":7},"end":{"row":3,"column":8}},"text":"Q"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":7},"end":{"row":3,"column":8}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"Q"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":9},"end":{"row":3,"column":10}},"text":"L"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":10},"end":{"row":4,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":4},"end":{"row":5,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":5,"column":0},"end":{"row":5,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":5,"column":4},"end":{"row":5,"column":5}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":5,"column":5},"end":{"row":5,"column":6}},"text":"Q"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":5,"column":6},"end":{"row":5,"column":7}},"text":"L"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":7,"column":53},"end":{"row":7,"column":502}},"text":"select c.title, '第' || e.episode_num || '話' as episode_num, e.episode_name, count(case when p.available = 'OK' then '1' end) as OK, count(case when p.available = 'NG' then '1' end) as NG, i.url from episodes e,contents c, posts p, images i where c.id = e.content_id and p.episode_id = e.id and c.id = i.generic_id and i.table_name = 'contents' group by c.title, e.episode_num, e.episode_name, i.url, e.created_at order by e.created_at desc limit 12\""}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":4},"end":{"row":4,"column":453}},"text":"select c.title, '第' || e.episode_num || '話' as episode_num, e.episode_name, count(case when p.available = 'OK' then '1' end) as OK, count(case when p.available = 'NG' then '1' end) as NG, i.url from episodes e,contents c, posts p, images i where c.id = e.content_id and p.episode_id = e.id and c.id = i.generic_id and i.table_name = 'contents' group by c.title, e.episode_num, e.episode_name, i.url, e.created_at order by e.created_at desc limit 12\""}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":4},"end":{"row":4,"column":5}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":5},"end":{"row":4,"column":6}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":5,"column":0},"end":{"row":5,"column":5}},"text":"    S"},{"action":"removeLines","range":{"start":{"row":4,"column":0},"end":{"row":5,"column":0}},"nl":"\n","lines":["      select c.title, '第' || e.episode_num || '話' as episode_num, e.episode_name, count(case when p.available = 'OK' then '1' end) as OK, count(case when p.available = 'NG' then '1' end) as NG, i.url from episodes e,contents c, posts p, images i where c.id = e.content_id and p.episode_id = e.id and c.id = i.generic_id and i.table_name = 'contents' group by c.title, e.episode_num, e.episode_name, i.url, e.created_at order by e.created_at desc limit 12\""]},{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":6}},"text":"select"},{"action":"insertText","range":{"start":{"row":4,"column":6},"end":{"row":5,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":5,"column":0},"end":{"row":32,"column":0}},"lines":["    c.title,","    '第' || e.episode_num || '話' as episode_num,","    e.episode_name,","    count(case ","        when p.available = 'OK' then '1' ","    end) as OK,","    count(case ","        when p.available = 'NG' then '1' ","    end) as NG,","    i.url ","from","    episodes e,","    contents c,","    posts p,","    images i ","where","    c.id = e.content_id ","    and p.episode_id = e.id ","    and c.id = i.generic_id ","    and i.table_name = 'contents' ","group by","    c.title,","    e.episode_num,","    e.episode_name,","    i.url,","    e.created_at ","order by"]},{"action":"insertText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":30}},"text":"    e.created_at desc limit 12"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":32,"column":30},"end":{"row":33,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":33,"column":0},"end":{"row":33,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":33,"column":4},"end":{"row":33,"column":5}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":52},"end":{"row":35,"column":53}},"text":"\""}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":4},"end":{"row":3,"column":5}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":5},"end":{"row":3,"column":6}},"text":"q"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":6},"end":{"row":3,"column":7}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":7},"end":{"row":3,"column":8}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"~"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"~"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"^"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":9},"end":{"row":3,"column":10}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":9},"end":{"row":3,"column":10}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"^"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":8},"end":{"row":3,"column":9}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":9},"end":{"row":3,"column":10}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":5,"column":0},"end":{"row":5,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":6,"column":0},"end":{"row":6,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":7,"column":0},"end":{"row":7,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":13,"column":0},"end":{"row":13,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":14,"column":0},"end":{"row":14,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":23,"column":0},"end":{"row":23,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":24,"column":0},"end":{"row":24,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":26,"column":0},"end":{"row":26,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":27,"column":0},"end":{"row":27,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":28,"column":0},"end":{"row":28,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":29,"column":0},"end":{"row":29,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":30,"column":0},"end":{"row":30,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":31,"column":0},"end":{"row":31,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":5,"column":0},"end":{"row":5,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":6,"column":0},"end":{"row":6,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":7,"column":0},"end":{"row":7,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":13,"column":0},"end":{"row":13,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":14,"column":0},"end":{"row":14,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":23,"column":0},"end":{"row":23,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":24,"column":0},"end":{"row":24,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":26,"column":0},"end":{"row":26,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":27,"column":0},"end":{"row":27,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":28,"column":0},"end":{"row":28,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":29,"column":0},"end":{"row":29,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":30,"column":0},"end":{"row":30,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":31,"column":0},"end":{"row":31,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":5,"column":0},"end":{"row":5,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":6,"column":0},"end":{"row":6,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":7,"column":0},"end":{"row":7,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":13,"column":0},"end":{"row":13,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":14,"column":0},"end":{"row":14,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":23,"column":0},"end":{"row":23,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":24,"column":0},"end":{"row":24,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":26,"column":0},"end":{"row":26,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":27,"column":0},"end":{"row":27,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":28,"column":0},"end":{"row":28,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":29,"column":0},"end":{"row":29,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":30,"column":0},"end":{"row":30,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":31,"column":0},"end":{"row":31,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":52},"end":{"row":35,"column":53}},"text":")"},{"action":"insertText","range":{"start":{"row":35,"column":52},"end":{"row":35,"column":53}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":53},"end":{"row":35,"column":54}},"text":"q"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":54},"end":{"row":35,"column":55}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":55},"end":{"row":35,"column":56}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":1,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":1,"column":2},"end":{"row":2,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":2,"column":0},"end":{"row":35,"column":0}},"lines":["","  @@str = Hash.new","  @@str['a'] = <<-S","    ('あ','い','う','え','お') ","    S","  @@str['k'] = <<-S","    ('か','き','く','け','こ') ","    S","  @@str['s'] = <<-S","    ('さ','し','す','せ','そ') ","    S","  @@str['t'] = <<-S","    ('た','ち','つ','て','と') ","    S","  @@str['n'] = <<-S","    ('な','に','ぬ','ね','の') ","    S","  @@str['h'] = <<-S","    ('は','ひ','ふ','へ','ほ') ","    S","  @@str['m'] = <<-S","    ('ま','み','む','め','も') ","    S","  @@str['y'] = <<-S","    ('や','ゆ','よ') ","    S","  @@str['r'] = <<-S","    ('ら','り','る','れ','ろ') ","    S","  @@str['w'] = <<-S","    ('わ','を','ん') ","    S","  "]},{"action":"insertText","range":{"start":{"row":38,"column":4},"end":{"row":39,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":39,"column":0},"end":{"row":39,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":40,"column":8},"end":{"row":40,"column":17}},"text":"  c.title"},{"action":"insertText","range":{"start":{"row":40,"column":8},"end":{"row":40,"column":12}},"text":"c.id"},{"action":"removeText","range":{"start":{"row":41,"column":8},"end":{"row":41,"column":9}},"text":" "},{"action":"insertText","range":{"start":{"row":41,"column":8},"end":{"row":41,"column":16}},"text":"c.title,"},{"action":"removeText","range":{"start":{"row":42,"column":8},"end":{"row":42,"column":10}},"text":"  "},{"action":"removeText","range":{"start":{"row":43,"column":8},"end":{"row":43,"column":10}},"text":"  "},{"action":"removeText","range":{"start":{"row":43,"column":19},"end":{"row":44,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":43,"column":19},"end":{"row":43,"column":40}},"text":"                     "},{"action":"insertText","range":{"start":{"row":43,"column":42},"end":{"row":44,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":44,"column":41},"end":{"row":44,"column":45}},"text":"'1' "},{"action":"removeText","range":{"start":{"row":44,"column":41},"end":{"row":45,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":44,"column":41},"end":{"row":44,"column":46}},"text":"1    "},{"action":"insertText","range":{"start":{"row":44,"column":48},"end":{"row":44,"column":58}},"text":"          "},{"action":"insertText","range":{"start":{"row":44,"column":58},"end":{"row":45,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":46,"column":0},"end":{"row":46,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":46,"column":19},"end":{"row":47,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":46,"column":19},"end":{"row":46,"column":40}},"text":"                     "},{"action":"insertText","range":{"start":{"row":46,"column":42},"end":{"row":47,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":47,"column":41},"end":{"row":47,"column":45}},"text":"'1' "},{"action":"removeText","range":{"start":{"row":47,"column":41},"end":{"row":48,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":47,"column":41},"end":{"row":47,"column":43}},"text":"1 "},{"action":"insertText","range":{"start":{"row":47,"column":45},"end":{"row":47,"column":58}},"text":"             "},{"action":"insertText","range":{"start":{"row":47,"column":58},"end":{"row":48,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":49,"column":8},"end":{"row":49,"column":10}},"text":"  "},{"action":"removeText","range":{"start":{"row":56,"column":0},"end":{"row":56,"column":4}},"text":"    "},{"action":"removeLines","range":{"start":{"row":50,"column":0},"end":{"row":56,"column":0}},"nl":"\n","lines":["      from","          episodes e,","          contents c,","          posts p,","          images i ","      where"]},{"action":"removeText","range":{"start":{"row":49,"column":13},"end":{"row":49,"column":14}},"text":" "},{"action":"removeText","range":{"start":{"row":49,"column":13},"end":{"row":50,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":49,"column":13},"end":{"row":49,"column":14}},"text":","},{"action":"insertText","range":{"start":{"row":49,"column":14},"end":{"row":50,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":50,"column":0},"end":{"row":96,"column":0}},"lines":["        to_char(e.created_at, 'YYYYMMDDHH24MISS')    as created_at","    from","        episodes e,","        contents c,","        posts p,","        images i        ","    where","        c.id = e.content_id                ","        and p.episode_id = e.id                ","        and c.id = i.generic_id                ","        and i.table_name = 'contents'        ","    group by","        e.created_at,","        c.id,","        c.title,","        e.episode_num,","        e.episode_name,","        i.url        ","    order by","        e.created_at desc limit 20","    SQL","    ","    return ActiveRecord::Base.connection.select_all(sql)","  end","def get_recent_by_week(week)","  sql = <<-SQL","  ","  select","      c.id,","      c.title, '第' || e.episode_num || '話' as episode_num,","      e.episode_name,","      count(case                        ","          when p.available = 'OK' then 1                ","      end) as OK,","      count(case                        ","          when p.available = 'NG' then 1                ","      end) as NG,","      i.url,","      to_char(e.created_at, 'YYYYMMDDHH24MISS')    as created_at","  from","      episodes e,","      contents c,","      posts p,","      images i,","      schedules s","  where"]},{"action":"removeText","range":{"start":{"row":96,"column":26},"end":{"row":97,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":96,"column":26},"end":{"row":96,"column":30}},"text":"    "},{"action":"insertText","range":{"start":{"row":96,"column":34},"end":{"row":96,"column":41}},"text":"       "},{"action":"insertText","range":{"start":{"row":96,"column":41},"end":{"row":97,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":97,"column":30},"end":{"row":98,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":97,"column":30},"end":{"row":97,"column":34}},"text":"    "},{"action":"insertText","range":{"start":{"row":97,"column":38},"end":{"row":97,"column":45}},"text":"       "},{"action":"insertText","range":{"start":{"row":97,"column":45},"end":{"row":98,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":98,"column":30},"end":{"row":99,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":98,"column":30},"end":{"row":98,"column":41}},"text":"           "},{"action":"insertText","range":{"start":{"row":98,"column":45},"end":{"row":99,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":107,"column":0},"end":{"row":107,"column":22}},"text":"          e.created_at"},{"action":"removeLines","range":{"start":{"row":100,"column":0},"end":{"row":107,"column":0}},"nl":"\n","lines":["      group by","          c.title,","          e.episode_num,","          e.episode_name,","          i.url,","          e.created_at ","      order by"]},{"action":"removeText","range":{"start":{"row":99,"column":35},"end":{"row":99,"column":36}},"text":" "},{"action":"removeText","range":{"start":{"row":99,"column":35},"end":{"row":100,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":99,"column":35},"end":{"row":100,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":100,"column":0},"end":{"row":182,"column":0}},"lines":["      and c.schedule_id = s.id","      and s.week = '#{week}'      ","  group by","      e.created_at,","      c.id,","      c.title,","      e.episode_num,","      e.episode_name,","      i.url        ","  order by","      e.created_at desc limit 20","  SQL","  ","  return ActiveRecord::Base.connection.select_all(sql)","end","def get_recent_by_atoz(atoz)","  ","  atoz = @@str[atoz]","  ","sql = <<-SQL","","select","    c.id,","    c.title, '第' || e.episode_num || '話' as episode_num,","    e.episode_name,","    count(case                        ","        when p.available = 'OK' then 1                ","    end) as OK,","    count(case                        ","        when p.available = 'NG' then 1                ","    end) as NG,","    i.url,","    to_char(e.created_at, 'YYYYMMDDHH24MISS')    as created_at","from","    episodes e,","    contents c,","    posts p,","    images i","where","    c.id = e.content_id                ","    and p.episode_id = e.id                ","    and c.id = i.generic_id                ","    and i.table_name = 'contents'","    and substring(c.initial for 1) IN #{atoz}","    ","group by","    e.created_at,","    c.id,","    c.title,","    e.episode_num,","    e.episode_name,","    i.url        ","order by","    e.created_at desc limit 12","SQL","","return ActiveRecord::Base.connection.select_all(sql)","end","  ","  def get_history","    sql = <<-SQL","","    select","        a.*   ","    from","        (select","            c.id,","            c.title,","            e.episode_num,","            e.episode_name,","            to_char(max(e.created_at),'YYYYMMDDHH24MI') as date","        from","            episodes e,","            contents c           ","        where","            e.content_id = c.id           ","        group by","            c.id ,","            c.title,","            e.episode_num,","            e.episode_name) as a  ","    order by"]},{"action":"insertText","range":{"start":{"row":182,"column":0},"end":{"row":182,"column":14}},"text":"        a.date"},{"action":"removeText","range":{"start":{"row":182,"column":27},"end":{"row":182,"column":28}},"text":"2"},{"action":"insertText","range":{"start":{"row":182,"column":27},"end":{"row":182,"column":28}},"text":"0"}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":6,"column":5},"end":{"row":6,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1409245083774,"hash":"54768e487eacfc33b4f60ede8e8ac44b74d8ef80"}